<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>6 Case study: Scraping Spanish school locations from the web | Data Harvesting with R</title>
<meta name="author" content="Jorge Cimentada">
<meta name="description" content="In this chapter we’ll be scraping the location of a sample of schools in Spain. This case study involves using XPath to find the specific chunks of code that contain coordinates of schools in...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="6 Case study: Scraping Spanish school locations from the web | Data Harvesting with R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://cimentadaj.github.io/dataharvesting/spanish-school.html">
<meta property="og:description" content="In this chapter we’ll be scraping the location of a sample of schools in Spain. This case study involves using XPath to find the specific chunks of code that contain coordinates of schools in...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="6 Case study: Scraping Spanish school locations from the web | Data Harvesting with R">
<meta name="twitter:description" content="In this chapter we’ll be scraping the location of a sample of schools in Spain. This case study involves using XPath to find the specific chunks of code that contain coordinates of schools in...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Lato-0.4.1/font.css" rel="stylesheet">
<link href="libs/_Roboto%20Mono-0.4.1/font.css" rel="stylesheet">
<link href="libs/_Montserrat-0.4.1/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet">
<script src="libs/str_view-binding-1.4.0/str_view.js"></script><link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
         (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-99618359-1', 'auto');
     ga('send', 'pageview');

    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h2>
        <a href="index.html" title="">Data Harvesting with R</a>
      </h2>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome</a></li>
<li class="book-part">Webscraping</li>
<li><a class="" href="primer-webscraping.html"><span class="header-section-number">2</span> A primer on Webscraping</a></li>
<li><a class="" href="data-formats-for-webscraping.html"><span class="header-section-number">3</span> Data Formats for Webscraping</a></li>
<li><a class="" href="regex.html"><span class="header-section-number">4</span> What you need to know about regular expressions</a></li>
<li><a class="" href="xpath-chapter.html"><span class="header-section-number">5</span> What you need to know about XPath</a></li>
<li><a class="active" href="spanish-school.html"><span class="header-section-number">6</span> Case study: Scraping Spanish school locations from the web</a></li>
<li><a class="" href="automating-scripts.html"><span class="header-section-number">7</span> Automating Web Scraping Scripts</a></li>
<li><a class="" href="scraping-javascript-based-website.html"><span class="header-section-number">8</span> Scraping JavaScript based website</a></li>
<li><a class="" href="ethical-issues.html"><span class="header-section-number">9</span> Ethical issues in Web Scraping</a></li>
<li class="book-part">APIs</li>
<li><a class="" href="intro-apis.html"><span class="header-section-number">10</span> Introduction to REST APIs</a></li>
<li><a class="" href="primer-apis.html"><span class="header-section-number">11</span> A primer on APIs</a></li>
<li><a class="" href="a-dialogue-between-computers.html"><span class="header-section-number">12</span> A dialogue between computers</a></li>
<li><a class="" href="json-chapter.html"><span class="header-section-number">13</span> What you need to know about JSON</a></li>
<li><a class="" href="case-study-exploring-the-amazon-api.html"><span class="header-section-number">14</span> Case study: Exploring the Amazon API</a></li>
<li><a class="" href="automating-api-programs-real-time-bicycle-data.html"><span class="header-section-number">15</span> Automating API programs: real-time bicycle data</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/cimentadaj/dataharvesting">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="spanish-school" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Case study: Scraping Spanish school locations from the web<a class="anchor" aria-label="anchor" href="#spanish-school"><i class="fas fa-link"></i></a>
</h1>
<p>In this chapter we’ll be scraping the location of a sample of schools in Spain. This case study involves using XPath to find the specific chunks of code that contain coordinates of schools in Spain, as well as inspecting the source code of a website in depth. The final result of this chapter is to generate a plot like this one without previous knowledge of where schools are:</p>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/automatic_rmarkdown/spain-map-schools-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>As usual, the website has been saved locally in the <code>scrapex</code> package such that any changes made on the website don’t break our code in the future. Althought the links we’ll be working with will be hosted locally on your machine, the HTML of the website should be very similar to the one hosted on the online website (with the exception of some images/icons which were deleted on purpose to make the package lightweight). With that said, the local website should be a fairly good representation of what you’ll find in real website on the internet. The website is in Spanish so I’ll make sure to point out specifically the type of information we’re looking for. Non-spanish speakers should be able to work through this chapter without a problem.</p>
<p>Before we begin, let’s load all the package we’ll use in the chapter:</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://xml2.r-lib.org/">xml2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://httr.r-lib.org/">httr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ropenscilabs/rnaturalearth">rnaturalearth</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">scrapex</span><span class="op">)</span></code></pre></div>
<div id="building-a-scraper-for-one-school" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Building a scraper for one school<a class="anchor" aria-label="anchor" href="#building-a-scraper-for-one-school"><i class="fas fa-link"></i></a>
</h2>
<p>Visualizing school locations can be useful for many things such as matching population density of children across different regions to school locations or mapping patterns of inequality by geographical locations. The website <code>www.buscocolegio.com</code> contains a database of schools for all of Spain, containing a plethora of information of each school, together with the coordinates of where the school is located. The function <code><a href="https://rdrr.io/pkg/scrapex/man/spanish_schools_ex.html">spanish_schools_ex()</a></code> contains the local links to each school.</p>
<p>Let’s look at an example for one school.</p>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">school_links</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scrapex/man/spanish_schools_ex.html">spanish_schools_ex</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Keep only the HTML file of one particular school.</span>
<span class="va">school_url</span> <span class="op">&lt;-</span> <span class="va">school_links</span><span class="op">[</span><span class="fl">13</span><span class="op">]</span>

<span class="va">school_url</span></code></pre></div>
<pre><code>## [1] "/home/runner/.local/share/renv/cache/v5/R-4.2/x86_64-pc-linux-gnu/scrapex/0.0.1.9999/9aa78cbb3eccaaa811756b4bf07fdd1a/scrapex/extdata/spanish_schools_ex/school_3006839.html"</code></pre>
<p>Let’s look at the rendered website with the code below:</p>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/browseURL.html">browseURL</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/scrapex/man/prep_browser.html">prep_browser</a></span><span class="op">(</span><span class="va">school_url</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/main_website_no_selection.png" width="100%" style="display: block; margin: auto;"></div>
<p>The website shows standard details of the school “CEIP SANCHIS GUARNER”. You can see it’s contact email and other contact details. Additionally, you can see it’s location on the right. We want to extract precisely that data to visualize their locations. How can we access those coordinates?</p>
<p>Let’s read the website into R before we start narrowing down how to obtain the coordinates:</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">school_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">school_url</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_child</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">school_raw</span></code></pre></div>
<pre><code>## {html_node}
## &lt;head&gt;
##  [1] &lt;title&gt;Aquí encontrarás toda la información necesaria sobre CEIP SANCHIS ...
##  [2] &lt;meta charset="utf-8"&gt;\n
##  [3] &lt;meta name="viewport" content="width=device-width, initial-scale=1, shri ...
##  [4] &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;\n
##  [5] &lt;meta name="author" content="BuscoColegio"&gt;\n
##  [6] &lt;meta name="description" content="Encuentra toda la información necesari ...
##  [7] &lt;meta name="keywords" content="opiniones SANCHIS GUARNER, contacto SANCH ...
##  [8] &lt;link rel="shortcut icon" href="/favicon.ico"&gt;\n
##  [9] &lt;link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto+Sl ...
## [10] &lt;link rel="stylesheet" href="https://s3.eu-west-3.amazonaws.com/buscocol ...
## [11] &lt;link rel="stylesheet" href="/assets/vendor/icon-awesome/css/font-awesom ...
## [12] &lt;link rel="stylesheet" href="/assets/vendor/icon-line/css/simple-line-ic ...
## [13] &lt;link rel="stylesheet" href="/assets/vendor/icon-line-pro/style.css"&gt;\n
## [14] &lt;link rel="stylesheet" href="/assets/vendor/icon-hs/style.css"&gt;\n
## [15] &lt;link rel="stylesheet" href="https://s3.eu-west-3.amazonaws.com/buscocol ...
## [16] &lt;link rel="stylesheet" href="https://s3.eu-west-3.amazonaws.com/buscocol ...
## [17] &lt;link rel="stylesheet" href="https://s3.eu-west-3.amazonaws.com/buscocol ...
## [18] &lt;link rel="stylesheet" href="https://s3.eu-west-3.amazonaws.com/buscocol ...
## [19] &lt;link rel="stylesheet" href="https://s3.eu-west-3.amazonaws.com/buscocol ...
## [20] &lt;link rel="stylesheet" href="https://s3.eu-west-3.amazonaws.com/buscocol ...
## ...</code></pre>
<p>At this point, we shouldn’t worry about exploring the actual website in R. It’s always a better idea to look at the code on your browser. Once you have an idea of where the data you’re looking for is, you can come back to the raw HTML and search for the specific tags.</p>
<p>Web scraping strategies are very specific to the website you’re after. You have to get very familiar with the website you’re interested to be able to match perfectly the information you’re looking for. In many cases, scraping two websites will require vastly different strategies.</p>
<p>The first thing we want to do is to start looking at the source code of the maps section on the right so you can start looking for hints of the coordinates somewhere in the code. We do that by popping up the <em>web developer’s tools</em>. All browsers support this tool and you can open it if you press CTRL + SHIFT + c at the same time (Firefox and Chrome support this hotkey). You can also open it by searching the settings menu of your browser and looking for ‘Web Developer Tools’. If a window on the right popped in full of code then you’re on the right track:</p>
<p><br></p>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/developer_tools.png" width="100%" style="display: block; margin: auto;"></div>
<p><br></p>
<p>Here we can search the source code of the website. If you place your mouse pointer over the lines of code from this right-most window, you’ll see sections of the website being highlighted in blue. This indicates which parts of the code refer to which parts of the website. We never should search the complete source code to find what we want but rather approximate our search by typing the text we’re looking for in the search bar at the top of the right window.</p>
<p>My first intuition is to search for the text just below the Google Maps:</p>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/main_page.png" width="100%" style="display: block; margin: auto;"></div>
<p><br></p>
<p>Searching for that text will be our best approximation because we’ll be just within the maps section of the code and we can start looking for coordinates there instead of the entire website. Let’s search for that in the search bar of developer tools:</p>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/search_developer_tools.png" width="100%" style="display: block; margin: auto;"></div>
<p><br></p>
<p>After we click enter, we’ll be automatically directed to the tag that has the information that we want.</p>
<p><br></p>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/location_tag.png" width="100%" style="display: block; margin: auto;"></div>
<p><br></p>
<p>At this point, I started browsing the tags in this part of code. To our surprise, we actually landed specifically where the coordinates are. We can see that the latitude and longitude of schools are found in an attributed called <code>href</code> in an <code>&lt;a&gt;</code> tag:</p>
<p><br></p>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/location_tag_zoomed.png" width="100%" style="display: block; margin: auto;"></div>
<p><br></p>
<p>Can you see the latitude and longitude fields in the text highlighted blue? It’s hidden in-between words. That is precisely the type of information we’re after. The <code>href</code> attribute of the <code>&lt;a&gt;</code> tag contains the coordinates.</p>
<p>Extracting all <code>&lt;a&gt;</code> tags from the website will yield hundreds of matches because <code>&lt;a&gt;</code> is a very common tag in HTML. Refining the search to <code>&lt;a&gt;</code> tags which have an <code>href</code> attribute will also yield hundreds of matches because <code>href</code> is the standard attribute to attach links within websites. We need to narrow down our search within the website.</p>
<p>One strategy is to find the ‘father’ or ‘grandfather’ node of this particular <code>&lt;a&gt;</code> tag and match it. The strategy is too look for an ascendant tag that has a particular property that is unique enough to narrow down the search. For example, if the father of the <code>&lt;a&gt;</code> tag would be only a <code>&lt;p&gt;</code> tag, then that would return dozens of results. By looking at the structure of this small HTML snippet from the right-most window, we see that the ‘father’ of this <code>&lt;a&gt;</code> tag is <code>&lt;p class="d-flex align-items-baseline g-mt-5'&gt;</code> which has a particularly long attribute named <code>class</code>. That seems like a good candidate to use:</p>
<p><br></p>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/father_p_tag.png" width="100%" style="display: block; margin: auto;"></div>
<p><br></p>
<p>The <code>&lt;p&gt;</code> tag is the father of both the <code>&lt;i&gt;</code> tag and the <code>&lt;a&gt;</code> tag we want to extract the coordinates from:</p>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/automatic_rmarkdown/unnamed-chunk-158-1.png" width="672" style="display: block; margin: auto;"></div>
<p>It’s important to not be intimidated by these tag names and long attributes. I also don’t know what any of these attributes mean. But what I do know is that this is the ‘father’ of the <code>&lt;a&gt;</code> tag I’m interested in. So using our XPath skills, let’s search for a <code>&lt;p&gt;</code> tag that has a class set to <code>'d-flex align-items-baseline g-mt-5'</code> and see if we get only one match. That would mean that we can identify that tag precisely:</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Search for all &lt;p&gt; tags with that class in the document</span>
<span class="va">school_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">"//p[@class='d-flex align-items-baseline g-mt-5']"</span><span class="op">)</span></code></pre></div>
<pre><code>## {xml_nodeset (1)}
## [1] &lt;p class="d-flex align-items-baseline g-mt-5"&gt;\r\n\t                    &lt; ...</code></pre>
<p>Only one match, so this is good news. This means that we can uniquely identify this particular <code>&lt;p&gt;</code> tag. Let’s refine the search to say: Find all <code>&lt;a&gt;</code> tags which are children of that specific <code>&lt;p&gt;</code> tag. This only means I’ll add a <code>"//a"</code> to the previous expression. Since there is only one <code>&lt;p&gt;</code> tag with the class, we’re interested in checking whether there is more than one <code>&lt;a&gt;</code> tag below this <code>&lt;p&gt;</code> tag.</p>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">school_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">"//p[@class='d-flex align-items-baseline g-mt-5']//a"</span><span class="op">)</span></code></pre></div>
<pre><code>## {xml_nodeset (1)}
## [1] &lt;a href="/Colegio/buscar-colegios-cercanos.action?colegio.latitud=38.8274 ...</code></pre>
<p>There we go! We can see the specific <code>href</code> that contains the latitude and longitude data we’re interested in. How do we extract the <code>href</code> attribute? <code>xml_attr</code> is the standard function to extract attributes out of tags:</p>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">location_str</span> <span class="op">&lt;-</span>
  <span class="va">school_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">"//p[@class='d-flex align-items-baseline g-mt-5']//a"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_attr.html">xml_attr</a></span><span class="op">(</span>attr <span class="op">=</span> <span class="st">"href"</span><span class="op">)</span>

<span class="va">location_str</span></code></pre></div>
<pre><code>## [1] "/Colegio/buscar-colegios-cercanos.action?colegio.latitud=38.8274492&amp;colegio.longitud=0.0221681"</code></pre>
<div id="data-cleaning-1" class="section level3" number="6.1.1">
<h3>
<span class="header-section-number">6.1.1</span> Data cleaning<a class="anchor" aria-label="anchor" href="#data-cleaning-1"><i class="fas fa-link"></i></a>
</h3>
<p>Ok, now we need some regular expression skills to get only the latitude and longitude. In the string with the coordinates we see that the first coordinate appears after the first <code>=</code>. Moreover, aside from the coordinates, there’s a few words like <code>colegio</code> (this is just spanish for school) and <code>longitud</code> that are in the middle of the two coordinates. With this mind, we can write the regex:</p>
<ul>
<li>
<code>"=.+$"</code> which captures a <code>=</code> followed by any character (the <code>.</code>) repeated 1 or more times (<code>+</code>) until the end of the string (<code>$</code>). In layman terms: extract any text after the <code>=</code> until the end of the string.</li>
</ul>
<p>Let’s apply that:</p>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">location</span> <span class="op">&lt;-</span>
  <span class="va">location_str</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="st">"=.+$"</span><span class="op">)</span>

<span class="va">location</span></code></pre></div>
<pre><code>## [[1]]
## [1] "=38.8274492&amp;colegio.longitud=0.0221681"</code></pre>
<p>The result is exactly what we wanted. Now we need to replaced everything that is not the coordinates. A regex for that would look like:</p>
<ul>
<li>
<code>"=|colegio\\.longitud"</code> which matches the <code>=</code> or <code>colegio.longitud</code> (remember that <code>|</code> stands for OR in regex). Why is the <code>.</code> preceded by two <code>\\</code>? As you saw in the previous regex that we used, the <code>.</code> in regular expressions means <em>any</em> character. To signal that we want this <code>.</code> to be matched literally we write it like <code>\\.</code>. In layman terms: match either <code>=</code> or <code>colegio.longitud</code>. Let’s apply it:</li>
</ul>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">location</span> <span class="op">&lt;-</span>
  <span class="va">location</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="st">"=|colegio\\.longitud"</span>, <span class="st">""</span><span class="op">)</span>

<span class="va">location</span></code></pre></div>
<pre><code>## [1] "38.8274492&amp;0.0221681"</code></pre>
<p>There we go. We replaced everything between the coordinates except the <code>&amp;</code> in between. Why didn’t we replace that? Because we’ll split the two coordinates by <code>&amp;</code> and have them both separate:</p>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">location</span> <span class="op">&lt;-</span>
  <span class="va">location</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="st">"&amp;"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">.</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>

<span class="va">location</span></code></pre></div>
<pre><code>## [1] "38.8274492" "0.0221681"</code></pre>
<p>Alright, so that’s the end of our data cleaning efforts. We managed to locate the specific HTML node that contained the school coordinates and extracted it using string manipulations. Now that we got that information for one single school, let’s turn that into a function so we can pass only the school’s link and get the coordinates back.</p>
</div>
</div>
<div id="scaling-the-scraper-to-all-schools" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Scaling the scraper to all schools<a class="anchor" aria-label="anchor" href="#scaling-the-scraper-to-all-schools"><i class="fas fa-link"></i></a>
</h2>
<p>When moving the code to scrape one single case to many cases, you’ll want to move the code into a function to make it more compact, organized and easy to read. Let’s move all our code into a function but also make sure to set your user agent as well add a time sleep of 5 seconds to the function (we’ll touch upon the reasons why adding a user-agent and a time sleep are important in chapter <a href="ethical-issues.html#ethical-issues">9</a>) because we want to make sure we don’t cause any troubles to the website we’re scraping due to an overload of requests:</p>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This sets your `User-Agent` globally so that all requests are identified with this `User-Agent`</span>
<span class="fu"><a href="https://httr.r-lib.org/reference/set_config.html">set_config</a></span><span class="op">(</span>
  <span class="fu"><a href="https://httr.r-lib.org/reference/user_agent.html">user_agent</a></span><span class="op">(</span><span class="st">"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:105.0) Gecko/20100101 Firefox/105.0; Jorge Cimentada / cimentadaj@gmail.com"</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Collapse all of the code from above into one function called</span>
<span class="co"># school grabber</span>

<span class="va">school_grabber</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">school_url</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># We add a time sleep of 5 seconds to avoid</span>
  <span class="co"># sending too many quick requests to the website</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>

  <span class="va">school_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">school_url</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html">xml_child</a></span><span class="op">(</span><span class="op">)</span>

  <span class="va">location_str</span> <span class="op">&lt;-</span>
    <span class="va">school_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">"//p[@class='d-flex align-items-baseline g-mt-5']//a"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_attr.html">xml_attr</a></span><span class="op">(</span>attr <span class="op">=</span> <span class="st">"href"</span><span class="op">)</span>

  <span class="va">location</span> <span class="op">&lt;-</span>
    <span class="va">location_str</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="st">"=.+$"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="st">"=|colegio\\.longitud"</span>, <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="st">"&amp;"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="va">.</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>

  <span class="co"># Turn into a data frame</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    latitude <span class="op">=</span> <span class="va">location</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
    longitude <span class="op">=</span> <span class="va">location</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,
    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="fu">school_grabber</span><span class="op">(</span><span class="va">school_url</span><span class="op">)</span></code></pre></div>
<pre><code>##     latitude longitude
## 1 38.8274492 0.0221681</code></pre>
<p>We can see that it worked for a single school, so we can try on all schools. The only thing left is to extract this for many schools. As shown earlier, <code>scrapex</code> contains a list of 27 school links that we can automatically scrape. Let’s loop over those, get the information of coordinates for each and collapse all of them into a data frame.</p>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coordinates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html">map_dfr</a></span><span class="op">(</span><span class="va">school_links</span>, <span class="va">school_grabber</span><span class="op">)</span>
<span class="va">coordinates</span></code></pre></div>
<pre><code>##    latitude  longitude
## 1  42.72779 -8.6567935
## 2  43.24439 -8.8921645
## 3  38.95592 -1.2255769
## 4  39.18657 -1.6225903
## 5  40.38245 -3.6410388
## 6  40.22929 -3.1106322
## 7  40.43860 -3.6970366
## 8  40.33514 -3.5155669
## 9  40.50546 -3.3738441
## 10 40.63826 -3.4537107
## 11 40.38543 -3.6639500
## 12 37.76485 -1.5030467
## 13 38.82745  0.0221681
## 14 40.99434 -5.6224391
## 15 40.99434 -5.6224391
## 16 40.56037 -5.6703725
## 17 40.99434 -5.6224391
## 18 40.99434 -5.6224391
## 19 41.13593  0.9901905
## 20 41.26155  1.1670507
## 21 41.22851  0.5461471
## 22 41.14580  0.8199749
## 23 41.18341  0.5680564
## 24 42.07820  1.8203155
## 25 42.25245  1.8621546
## 26 41.73767  1.8383666
## 27 41.62345  2.0013628</code></pre>
<p>So now that we have the locations of these schools, let’s plot them:</p>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coordinates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all</a></span><span class="op">(</span><span class="va">coordinates</span>, <span class="va">as.numeric</span><span class="op">)</span>

<span class="va">sp_sf</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rnaturalearth/man/ne_countries.html">ne_countries</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="st">"large"</span>, country <span class="op">=</span> <span class="st">"Spain"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sp_sf</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">coordinates</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">10</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Sample of schools in Spain"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/automatic_rmarkdown/spain-map-schools-1.png" width="672" style="display: block; margin: auto;"></div>
<p>There’s it is! We managed to extract the coordinates of all the schools, clean them and plot them.</p>
</div>
<div id="scraping-publicprivate-school-information" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Scraping public/private school information<a class="anchor" aria-label="anchor" href="#scraping-publicprivate-school-information"><i class="fas fa-link"></i></a>
</h2>
<p>Suppose that working as a consultant for the ministry of economy, they task you with understanding whether public/private schools are correlated with income inequality at the neighborhood level. There’s many public sources nowadays that can tell you the average income for a given neighborhood so we can find that data already cleaned and ready to use for us on the internet. However, it’s difficult to find a list of all national schools of a country together with the information on whether they’re public or private.</p>
<p>As we saw in <code>www.buscocolegio.com</code>, each school website has also information on whether a school is public or private. It’s exactly here:</p>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/main_website_public_private.png" width="100%" style="display: block; margin: auto;"></div>
<p>“Centro Público” means Public Center. If we managed to build a scraper to extract this information we would know if a school is either public or private. Let’s open up web developer tools and look specifically at the tag that is highlighted when clicking on “Centro Público”:</p>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/tag_public_private.png" width="100%" style="display: block; margin: auto;"></div>
<p>The public/private information we’re interested is within a <code>&lt;strong&gt;</code> tag. This tag in HTML means that the text will be in bold (althought we don’t care about what each tag does, it’s handy to know). Searching simply for a <code>&lt;strong&gt;</code> tag will probably yield dozens of matches since <code>&lt;strong&gt;</code> is too generic. We need to find a more unique tag that identifies the entire box. At this point, I started looking at the father tags above <code>&lt;strong&gt;</code> and found the 1st ascendant of the <code>&lt;strong&gt;</code> tag:</p>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/father_tag_public_private.png" width="100%" style="display: block; margin: auto;"></div>
<p>The <code>&lt;div&gt;</code> tag with class <code>'col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px-15 g-py-25'</code> seems unique enough to give it a try. Let’s try:</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">school_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">"//div[@class='col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px-15 g-py-25']"</span><span class="op">)</span></code></pre></div>
<pre><code>## {xml_nodeset (10)}
##  [1] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [2] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [3] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [4] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [5] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [6] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [7] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [8] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [9] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
## [10] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...</code></pre>
<p>Ok, this makes sense. It returns 10 nodes because this same <code>&lt;div&gt;</code> is present in all details of the bigger details box:</p>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/main_website_details_box.png" width="100%" style="display: block; margin: auto;"></div>
<p>One strategy is to extract all <code>&lt;strong&gt;</code> tags within that tag and extract the text. If we find the “Centro Público” text in there, we can use some regex to extract it:</p>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">text_boxes</span> <span class="op">&lt;-</span>
  <span class="va">school_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">"//div[@class='col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px-15 g-py-25']//strong"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_text.html">xml_text</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">text_boxes</span></code></pre></div>
<pre><code>##  [1] "616522706"                                                         
##  [2] "966428835"                                                         
##  [3] "03006839@edu.gva.es"                                               
##  [4] "-"                                                                 
##  [5] "966428836"                                                         
##  [6] "3006839"                                                           
##  [7] "Centro Público"                                                    
##  [8] "Colegio de Educación Infantil y Primaria"                          
##  [9] "GENERALITAT VALENCIANA"                                            
## [10] "Vuelta al cole, inicio y fin de clases, vacaciones y días festivos"</code></pre>
<p>We can see the type of school right there in slot 7 of the vector. Let’s finalize this by detecting the string with a pattern and extracting it:</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">single_public_private</span> <span class="op">&lt;-</span>
  <span class="va">text_boxes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="st">"Centro"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">text_boxes</span><span class="op">[</span><span class="va">.</span><span class="op">]</span>

<span class="va">single_public_private</span></code></pre></div>
<pre><code>## [1] "Centro Público"</code></pre>
<p>There we go. We have the scaffold code to build a function and extract this for all schools. Let’s move our code into a function that accepts one school url and loop over all schools:</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grab_public_private_school</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">school_link</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
  <span class="va">school</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">school_link</span><span class="op">)</span>
  <span class="va">text_boxes</span> <span class="op">&lt;-</span>
    <span class="va">school</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">"//div[@class='col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px-15 g-py-25']//strong"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_text.html">xml_text</a></span><span class="op">(</span><span class="op">)</span>

  <span class="va">single_public_private</span> <span class="op">&lt;-</span>
    <span class="va">text_boxes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="st">"Centro"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="va">text_boxes</span><span class="op">[</span><span class="va">.</span><span class="op">]</span>


  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    public_private <span class="op">=</span> <span class="va">single_public_private</span>,
    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">public_private_schools</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html">map_dfr</a></span><span class="op">(</span><span class="va">school_links</span>, <span class="va">grab_public_private_school</span><span class="op">)</span>
<span class="va">public_private_schools</span></code></pre></div>
<pre><code>##    public_private
## 1  Centro Privado
## 2  Centro Público
## 3  Centro Público
## 4  Centro Público
## 5  Centro Privado
## 6  Centro Público
## 7  Centro Público
## 8  Centro Privado
## 9  Centro Público
## 10 Centro Público
## 11 Centro Público
## 12 Centro Público
## 13 Centro Público
## 14 Centro Público
## 15 Centro Público
## 16 Centro Público
## 17 Centro Público
## 18 Centro Privado
## 19 Centro Público
## 20 Centro Público
## 21 Centro Privado
## 22 Centro Público
## 23 Centro Privado
## 24 Centro Público
## 25 Centro Público
## 26 Centro Privado
## 27 Centro Público</code></pre>
<p>With this info at hand we can merge it with the coordinates of the school and visualize public/private schools by location:</p>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Let's translate the public/private names from Spanish to English</span>
<span class="va">lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Centro Público"</span> <span class="op">=</span> <span class="st">"Public"</span>, <span class="st">"Centro Privado"</span> <span class="op">=</span> <span class="st">"Private"</span><span class="op">)</span>
<span class="va">public_private_schools</span><span class="op">$</span><span class="va">public_private</span> <span class="op">&lt;-</span> <span class="va">lookup</span><span class="op">[</span><span class="va">public_private_schools</span><span class="op">$</span><span class="va">public_private</span><span class="op">]</span>

<span class="co"># Merge it with the coordinates data</span>
<span class="va">all_schools</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">coordinates</span>, <span class="va">public_private_schools</span><span class="op">)</span>

<span class="co"># Plot private/public by coordinates</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sp_sf</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">all_schools</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, color <span class="op">=</span> <span class="va">public_private</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">10</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Sample of schools in Spain by private/public"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/automatic_rmarkdown/unnamed-chunk-177-1.png" width="672" style="display: block; margin: auto;"></div>
</div>
<div id="extracting-type-of-school" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Extracting type of school<a class="anchor" aria-label="anchor" href="#extracting-type-of-school"><i class="fas fa-link"></i></a>
</h2>
<p>One additional information that might also be useful to know is the type of each school: kindergarten, secondary school, primary school, etc. This information is just next to whether the school is private or public:</p>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/main_website_type_school.png" width="100%" style="display: block; margin: auto;"></div>
<p>Now, you might think we can just copy the exact code from the previous extraction but this one is slightly different. The problem is that we don’t know in advance what the type of school each school might be. That is, we can’t use regex to search (like we did for the public/private) for something like “Primary” because it can be “Primary school” or many other types of school. What we have to do here is to search for the header of the box:</p>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/main_website_type_school_header.png" width="100%" style="display: block; margin: auto;"></div>
<p>We recycle the first XPath from the public/private scraper and then find the exact <code>&lt;div&gt;</code> that belongs to the type of school:</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">text_boxes</span> <span class="op">&lt;-</span>
  <span class="va">school_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">"//div[@class='col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px-15 g-py-25']"</span><span class="op">)</span>

<span class="va">text_boxes</span></code></pre></div>
<pre><code>## {xml_nodeset (10)}
##  [1] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [2] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [3] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [4] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [5] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [6] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [7] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [8] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
##  [9] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...
## [10] &lt;div class="col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px ...</code></pre>
<p>Those are the 10 nodes we saw before. Let’s extract the text within each one and match to where is the keyword from the header “Tipo Centro”:</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">selected_node</span> <span class="op">&lt;-</span> <span class="va">text_boxes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_text.html">xml_text</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="st">"Tipo Centro"</span><span class="op">)</span>
<span class="va">selected_node</span></code></pre></div>
<pre><code>##  [1] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE</code></pre>
<p>The 7th node is the one we’re looking for. Let’s subset that node and from here on we can do as we did last time: extract the <code>strong</code> tag. Note that we’ll use the XPath <code>.//strong</code>. <code>.//strong</code> means to find all <code>strong</code> tags but the <code>.</code> means to search for all tags <em>below</em> the current selection. If we would write instead <code>//strong</code>, it would search for all <code>strong</code> tags in the entire source code. The <code>.</code> in front tells XPath to search downwards from the current selection. Let’s write that and confirmar that we get the correct text:</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">single_type_school</span> <span class="op">&lt;-</span>
  <span class="va">text_boxes</span><span class="op">[</span><span class="va">selected_node</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">".//strong"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_text.html">xml_text</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">single_type_school</span></code></pre></div>
<pre><code>## [1] "Colegio de Educación Infantil y Primaria"</code></pre>
<p>Perfect, that’s the type of school that is also on the website. “Colegio de Educación Infantil y Primaria” means “Pre-school and Primary School”. With the code ready, we can wrap it all in a function and extract for all schools:</p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grab_type_school</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">school_link</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
  <span class="va">school</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">school_link</span><span class="op">)</span>

  <span class="va">text_boxes</span> <span class="op">&lt;-</span>
    <span class="va">school</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">"//div[@class='col-6 g-brd-left g-brd-bottom g-theme-brd-gray-light-v3 g-px-15 g-py-25']"</span><span class="op">)</span>

  <span class="va">selected_node</span> <span class="op">&lt;-</span>
    <span class="va">text_boxes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_text.html">xml_text</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="st">"Tipo Centro"</span><span class="op">)</span>

  <span class="va">single_type_school</span> <span class="op">&lt;-</span>
    <span class="va">text_boxes</span><span class="op">[</span><span class="va">selected_node</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="st">".//strong"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_text.html">xml_text</a></span><span class="op">(</span><span class="op">)</span>


  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    type_school <span class="op">=</span> <span class="va">single_type_school</span>,
    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">all_type_schools</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html">map_dfr</a></span><span class="op">(</span><span class="va">school_links</span>, <span class="va">grab_type_school</span><span class="op">)</span>
<span class="va">all_type_schools</span></code></pre></div>
<pre><code>##                                     type_school
## 1                              Escuela Infantil
## 2                              Escuela Infantil
## 3                              Escuela Infantil
## 4                              Escuela Infantil
## 5                              Escuela Infantil
## 6  Escuela de Educación Infantil, Casa de Niños
## 7                              Escuela Infantil
## 8                              Escuela Infantil
## 9                              Escuela Infantil
## 10 Escuela de Educación Infantil, Casa de Niños
## 11                             Escuela Infantil
## 12      Escuela Municipal de Educación Infantil
## 13     Colegio de Educación Infantil y Primaria
## 14                             Escuela Infantil
## 15                             Escuela Infantil
## 16                             Escuela Infantil
## 17                             Escuela Infantil
## 18                             Escuela Infantil
## 19                                       Escola
## 20                                       Escola
## 21                                       Escola
## 22                                       Escola
## 23                                       Escola
## 24                                       Escola
## 25                                       Escola
## 26                                       Escola
## 27                                       Escola</code></pre>
<p>Let’s merge it to the previous data on schools and visualize the points by both private/public as well as type of school:</p>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_schools</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">all_schools</span>, <span class="va">all_type_schools</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sp_sf</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">all_schools</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, color <span class="op">=</span> <span class="va">public_private</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">10</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">type_school</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Sample of schools in Spain"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/automatic_rmarkdown/unnamed-chunk-185-1.png" width="672" style="display: block; margin: auto;"></div>
<p>As you might have seen from this chapter, webscraping is all about being creative. Finding somewhat unique tags that identify the data you’re looking for is not a precise science and requires tricks using regular expressions, string manipulations and handy XPath knowledge. In the exercises below you’ll need to be creative and find clever ways to extract additional data from the schools data.</p>
</div>
<div id="exercises-4" class="section level2" number="6.5">
<h2>
<span class="header-section-number">6.5</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-4"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li>On the left menu click where it says “Enseñanzas” (teachings in english). I want you to extract the <em>unique</em> modality of the school. This is whether the school has remote or in-presence classes. You can find the information here:</li>
</ol>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/school_modality.png" width="100%" style="display: block; margin: auto;"></div>
<p>For this school, all classes are in-presence or “presencial” in Spanish. You result should be a data frame of one column with 27 rows (one for each school). You result should be like this but for the 27 schools:</p>
<pre><code>##   mode_school
## 1  Presencial
## 2  Presencial
## 3  Presencial
## 4  Presencial
## 5  Presencial
## 6  Presencial</code></pre>
<p><strong>Hint: it might be handy to pick tags in XPath using indices such as <code>//tag[2]</code> to get the specific index you want.</strong></p>
<ol start="2" style="list-style-type: decimal">
<li>On the left menu click where it says “Servicios” (services in English). I want you to extract all services that each school provides. In this example, the school provides “Comedor escolar” (school cafeteria) and “Transporte” (transportation):</li>
</ol>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/services_school.png" width="100%" style="display: block; margin: auto;"></div>
<p>You result should look something like this but for 27 schools:</p>
<pre><code>##                      amenities
## 11                        &lt;NA&gt;
## 12                        &lt;NA&gt;
## 13 Comedor Escolar, Transporte
## 14                     Comedor
## 15                     Comedor
## 16                        &lt;NA&gt;</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>From the main school page, extract the address of the school. The information is here:</li>
</ol>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/school_address_selection.png" width="100%" style="display: block; margin: auto;"></div>
<p>Your result should be like this but for 27 schools:</p>
<pre><code>##                                                                             addresses
## 1                  CALZADA S/N-IRIA. 15917. Puente-Cesures, Padrón, A Coruña, GALICIA
## 2                                 TRABE. 15110. A Trabe, Ponteceso, A Coruña, GALICIA
## 3                      CL. MEJORADA, S/N. 02690. Alpera, Albacete, CASTILLA-LA MANCHA
## 4 TR. CANTARRANAS, 3 B. 02610. El Bonillo, Bonillo (El), Albacete, CASTILLA-LA MANCHA
## 5                                 C/ de la Fuente de Piedra 10. 28018. Madrid, MADRID
## 6                                    C/ Mayor 29. 28596. Brea de Tajo, Madrid, MADRID</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>On the main page of the website, if you scroll down you’ll find a part of the website like this:</li>
</ol>
<div class="inline-figure"><img src="images/cs_spanish_school_locations/buscocolegios_xml/other_schools_href.png" width="100%" style="display: block; margin: auto;"></div>
<p>These are schools that other people visited when visiting this specific school. If you were doing some type of network analysis, you might want to analyze whether people visiting certain type of schools are interested in schools with certain properties. For that, you might need to actually go to the other school’s websites and extract information. Right now we won’t do that, but your task is to extract the other school’s links in case you wanted to automatically scrape these schools as well. For each school, you’ll have four links to other similar schools. Your result should be like this but for 27 schools:</p>
<pre><code>## # A tibble: 27 × 4
##    school_one                                school_two school_three school_four
##    &lt;chr&gt;                                     &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;      
##  1 /Colegio/detalles-colegio.action?id=1500… /Colegio/… /Colegio/de… /Colegio/d…
##  2 /Colegio/detalles-colegio.action?id=1502… /Colegio/… /Colegio/de… /Colegio/d…
##  3 /Colegio/detalles-colegio.action?id=2009… /Colegio/… /Colegio/de… /Colegio/d…
##  4 /Colegio/detalles-colegio.action?id=2009… /Colegio/… /Colegio/de… /Colegio/d…
##  5 /Colegio/detalles-colegio.action?id=2804… /Colegio/… /Colegio/de… /Colegio/d…
##  6 /Colegio/detalles-colegio.action?id=2804… /Colegio/… /Colegio/de… /Colegio/d…
##  7 /Colegio/detalles-colegio.action?id=2806… /Colegio/… /Colegio/de… /Colegio/d…
##  8 /Colegio/detalles-colegio.action?id=2805… /Colegio/… /Colegio/de… /Colegio/d…
##  9 /Colegio/detalles-colegio.action?id=2806… /Colegio/… /Colegio/de… /Colegio/d…
## 10 /Colegio/detalles-colegio.action?id=2805… /Colegio/… /Colegio/de… /Colegio/d…
## # … with 17 more rows</code></pre>
<p><strong>Hint: you’ll want to look for the hyperlink that leads to each school in the <code>href</code> tag.</strong></p>
<ol start="5" style="list-style-type: decimal">
<li>Combine <code>all_schools</code> with the previous exercises into a final data frame for each school. Final result should like this but for 27 schools:</li>
</ol>
<pre><code>## # A tibble: 27 × 11
##    latitude longitude public_private type_school mode_school amenities addresses
##       &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;    
##  1     42.7     -8.66 Private        Escuela In… Presencial  &lt;NA&gt;      CALZADA …
##  2     43.2     -8.89 Public         Escuela In… Presencial  &lt;NA&gt;      TRABE. 1…
##  3     39.0     -1.23 Public         Escuela In… Presencial  &lt;NA&gt;      CL. MEJO…
##  4     39.2     -1.62 Public         Escuela In… Presencial  &lt;NA&gt;      TR. CANT…
##  5     40.4     -3.64 Private        Escuela In… Presencial  &lt;NA&gt;      C/ de la…
##  6     40.2     -3.11 Public         Escuela de… Presencial  &lt;NA&gt;      C/ Mayor…
##  7     40.4     -3.70 Public         Escuela In… Presencial  Horario … JOSÉ ABA…
##  8     40.3     -3.52 Private        Escuela In… Presencial  &lt;NA&gt;      C/ Feder…
##  9     40.5     -3.37 Public         Escuela In… Presencial  &lt;NA&gt;      C/ José …
## 10     40.6     -3.45 Public         Escuela de… Presencial  &lt;NA&gt;      C/ Subid…
## # … with 17 more rows, and 4 more variables: school_one &lt;chr&gt;,
## #   school_two &lt;chr&gt;, school_three &lt;chr&gt;, school_four &lt;chr&gt;</code></pre>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="xpath-chapter.html"><span class="header-section-number">5</span> What you need to know about XPath</a></div>
<div class="next"><a href="automating-scripts.html"><span class="header-section-number">7</span> Automating Web Scraping Scripts</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#spanish-school"><span class="header-section-number">6</span> Case study: Scraping Spanish school locations from the web</a></li>
<li>
<a class="nav-link" href="#building-a-scraper-for-one-school"><span class="header-section-number">6.1</span> Building a scraper for one school</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#data-cleaning-1"><span class="header-section-number">6.1.1</span> Data cleaning</a></li></ul>
</li>
<li><a class="nav-link" href="#scaling-the-scraper-to-all-schools"><span class="header-section-number">6.2</span> Scaling the scraper to all schools</a></li>
<li><a class="nav-link" href="#scraping-publicprivate-school-information"><span class="header-section-number">6.3</span> Scraping public/private school information</a></li>
<li><a class="nav-link" href="#extracting-type-of-school"><span class="header-section-number">6.4</span> Extracting type of school</a></li>
<li><a class="nav-link" href="#exercises-4"><span class="header-section-number">6.5</span> Exercises</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/cimentadaj/dataharvesting/blob/main/book/06-case_study_webscraping_spanish_schools.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/cimentadaj/dataharvesting/edit/main/book/06-case_study_webscraping_spanish_schools.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Harvesting with R</strong>" was written by Jorge Cimentada. It was last built on 2023-02-08.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
